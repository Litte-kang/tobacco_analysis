        <div class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
            <li><a href="/workflows/fresh_tobacco">鲜烟素质分析 <span class="sr-only">(current)</span></a></li>
            <li><a href="/workflows/fresh_tobacco/packings">装烟情况统计</a></li>
            <li><a href="/workflows/dry_tobacco">烘烤量统计</a></li>
            <li><a href="#">烤房使用情况统计</a></li>
            <li class="active"><a href="#">烤房远程监管</a></li>
          </ul>         
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 class="page-header">Monitor</h1>
          <div class="row">
            <div class="col-xs-2"><input id="roomNo" type="text" class="form-control" placeholder="烤房编号"></div>
            <div class="col-xs-2">
                <div class="form-group">
                  <div class="input-group">
                      <div class="input-group-addon">开始日期</div>
                      <input type="text" class="form-control" id="startTime" name="startDate" />
                  </div>
                </div> 
            </div>
            <div class="col-xs-2">
                <div class="form-group">
                  <div class="input-group">
                      <div class="input-group-addon">结束日期</div>
                      <input type="text" class="form-control" id="endTime" name="endDate" />
                  </div>
                </div> 
            </div>
            <div class="col-xs-2"><button id="search_btn" type="button" class="btn btn-primary">搜索</button></div>
          </div>
          <div class="row">
            <div class="col-xs-2">
              <h3 id="h3_room_no">#40烤房</h3>
            </div>
            <div class="col-xs-2">
              <button class="btn btn-default" type="submit" id="show_chart">显示图表</button>
            </div>
          </div>
          <div class="row">
            <canvas id="myChart" height="400" width="947" style="display: none"></canvas>
          </div>
          <div class="row"></div>
          <div class="table-responsive">
            <table id="alarms" class="table table-striped table-hover table-condensed cell-border">
              <thead>
                <tr>
                  <th>时间</th>
                  <th>干球实际温度</th>
                  <th>湿球实际温度</th>
                
                </tr>
              </thead>
              <tbody>
                
              </tbody>
            </table>
          </div>
        </div>
      </div>
<script type="text/javascript">
  $(document).ready(function() {
    var table =  $('#alarms').dataTable({
        "ajax": 'http://121.41.111.212:1337/alarms/40',
        "retrieve": true,
        "searching" : false
    });

    var alarmChart;

    $('#search_btn').on('click', function(){
      var roomNo = $('#roomNo').val();
      
      if(roomNo != ''){
        console.log('send request' + roomNo);
        $getJSON('http://121.41.111.212:1337/alarms/' + roomNo, function(data){
          if(data.length > 0){
              table.api().ajax.url('http://121.41.111.212:1337/alarms/' + roomNo).load();

             
          }else
              table.api().ajax.clear();
        })
         $('#h3_room_no').text('#' + roomNo + '烤房');
        // table.api().ajax.url('http://121.41.111.212:1337/alarms/' + roomNo).load();

        // $('#h3_room_no').text('#' + roomNo + '烤房');
        alarmChart.Line(prepairDatasets(table));
        alarmChart.update();
      }
      else
        alert('请填写烤房号');
    });

    $('#show_chart').on('click', function(){
        $('#myChart').show();  

        alarmChart = initChart();
        alarmChart.Line(prepairDatasets(table));
    });

    var prepairDatasets = function (dataTable){
       var dryBall = dataTable.api().columns(1).data().reduce(function (a,b) {
            return a + b;
        } );
        var wetBall = dataTable.api().columns(2).data().reduce(function (a, b){
            return a + b;
        });
        
        var labels = dataTable.api().columns(0).data().reduce(function (a, b){
            return a + b;
        });

        var data = {};
        datasets = [];
        var dryLine = {
            label: "干球实际温度",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: dryBall
        };

        var wetLine = {
            label: "湿球实际温度",
            fillColor: "rgba(151,187,205,0.2)",
            strokeColor: "rgba(151,187,205,1)",
            pointColor: "rgba(151,187,205,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: wetBall
        };
        datasets.push(dryLine);
        datasets.push(wetLine);

        data.labels = labels;
        data.datasets = datasets;



        // var ctx = $("#myChart").get(0).getContext("2d");
        // var myLineChart = new Chart(ctx).Line(data);
        return data;
    }

    function initChart(){
      var ctx = $("#myChart").get(0).getContext("2d");
      return new Chart(ctx);
    }

    var chartOpts = {

        ///Boolean - Whether grid lines are shown across the chart
        scaleShowGridLines : true,

        //String - Colour of the grid lines
        scaleGridLineColor : "rgba(0,0,0,.05)",

        //Number - Width of the grid lines
        scaleGridLineWidth : 1,

        //Boolean - Whether to show horizontal lines (except X axis)
        scaleShowHorizontalLines: true,

        //Boolean - Whether to show vertical lines (except Y axis)
        scaleShowVerticalLines: true,

        //Boolean - Whether the line is curved between points
        bezierCurve : false,

        //Number - Tension of the bezier curve between points
        bezierCurveTension : 0.4,

        //Boolean - Whether to show a dot for each point
        pointDot : true,

        //Number - Radius of each point dot in pixels
        pointDotRadius : 4,

        //Number - Pixel width of point dot stroke
        pointDotStrokeWidth : 1,

        //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
        pointHitDetectionRadius : 20,

        //Boolean - Whether to show a stroke for datasets
        datasetStroke : true,

        //Number - Pixel width of dataset stroke
        datasetStrokeWidth : 2,

        //Boolean - Whether to fill the dataset with a colour
        datasetFill : true
      };
  });
</script>